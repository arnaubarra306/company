SET AUTOCOMMIT=1;

CREATE DATABASE IF NOT EXISTS company;

USE company;


CREATE TABLE IF NOT EXISTS company.DEPT (
 DEPT_NO  INT (2) UNSIGNED,
 DNAME     VARCHAR(14) NOT NULL UNIQUE,
 LOC      VARCHAR(14),
 PRIMARY KEY (DEPT_NO) ) ;


CREATE TABLE IF NOT EXISTS company.CUST (
 COMP_NO    INT (4) UNSIGNED,
 SURNAME    VARCHAR (10) NOT NULL,
 DEPT       VARCHAR (10),
 BOSS       INT (4) UNSIGNED,
 DATE		DATE,
 SALARY    INT UNSIGNED,
 COMISSION  INT UNSIGNED,
 DEPT_NO   INT (2) UNSIGNED NOT NULL,
 PRIMARY KEY (COMP_NO),
 INDEX IDX_COMP_CAP (CAP),
 INDEX IDX_COMP_DEPT_NO (DEPT_NO),
 FOREIGN KEY (DEPT_NO) REFERENCES company.DEPT(DEPT_NO)) ;


CREATE TABLE IF NOT EXISTS company.CUST (
 CUST_COD          INT(6) UNSIGNED PRIMARY KEY,
 NAME                VARCHAR (45) NOT NULL,
 ADRESS              VARCHAR (40) NOT NULL,
 CITY                VARCHAR (30) NOT NULL,
 STATE               VARCHAR (2),
 POSTAL_CODE         VARCHAR (9) NOT NULL,
 AREA                INT(3),
 PHONE	          VARCHAR (9),
 REPR_COD            INT(4) UNSIGNED,
 LIMIT_CREDIT        DECIMAL(9,2) UNSIGNED,
 OBSERVATIONS        TEXT,
 INDEX IDX_CUST_REPR_COD (REPR_COD),
 FOREIGN KEY (REPR_COD) REFERENCES company.COMP(COMP_NO));


CREATE TABLE IF NOT EXISTS company.PRODUCT (
 PROD_NUM     INT (6) UNSIGNED PRIMARY KEY,
 DESCRIPTION  VARCHAR (30) NOT NULL  UNIQUE);


CREATE TABLE IF NOT EXISTS company.ORDER  (
 COM_NUM             INT(4) UNSIGNED PRIMARY KEY,
 COM_DATA            DATE,
 COM_TIPUS           CHAR (1) CHECK (COM_TIPUS IN ('A','B','C')),
 CUST_COD            INT (6) UNSIGNED NOT NULL,
 DATA_TRAMESA        DATE,
 TOTAL               DECIMAL(8,2) UNSIGNED,
 INDEX IDX_ORDER _CUST_COD (CUST_COD),
 FOREIGN KEY (CUST_COD) REFERENCES company.CUST (CUST_COD) );


CREATE TABLE IF NOT EXISTS company.DETAIL  (
 COM_NUM             INT(4) UNSIGNED,
 DETAIL_NUM          INT(4) UNSIGNED,
 PROD_NUM            INT(6) UNSIGNED NOT NULL,
 SELL_PRICE          DECIMAL(8,2) UNSIGNED,
 QUANTITY            INT (8),
 IMPORT              DECIMAL(8,2),
 CONSTRAINT DETAIL_PK PRIMARY KEY (COM_NUM,DETAIL_NUM),
 INDEX IDX_DETAL_COM_NUM (COM_NUM),
 INDEX IDX_PROD_NUM (PROD_NUM),
 FOREIGN KEY (COM_NUM) REFERENCES company.ORDER  (COM_NUM),
 FOREIGN KEY (PROD_NUM) REFERENCES company.PRODUCTE(PROD_NUM));

CREATE INDEX COMP_SURNAME ON company.COMP (SUNAME);
CREATE INDEX COMP_DEPT_NO_COMP ON company.COMP (DEPT_NO,COMP_NO);

ALTER TABLE company.COMP
ADD FOREIGN KEY (CAP) REFERENCES COMP(COMP_NO);

CREATE INDEX CUST_NOM ON company.CUST (NOM);
CREATE INDEX CUST_REPR_CUST ON company.CUST (REPR_COD, CUST_COD);
CREATE INDEX DETAIL_PROD_COM_DET ON company.DETAIL (PROD_NUM,COM_NUM,DETAIL_NUM);
CREATE INDEX ORDER_DATA_NUM ON company.ORDER  (COM_DATA,COM_NUM);
CREATE INDEX ORDER_TRANSMISION_NUM ON company.ORDER  (DATA_TRANSMISION,COM_NUM);
